// –æ–∂–∏–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ DOM –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º js
document.addEventListener('DOMContentLoaded', () => {
    // –û–°–ù–û–í–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
    let grid = []; // –º–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
    let score = 0; // —Ç–µ–∫—É—â–∏–π —Å—á–µ—Ç –∏–≥—Ä–æ–∫–∞
    let bestScore = localStorage.getItem('bestScore') || 0; // –ø–æ–ø—ã—Ç–∫–∞ –≤–∑—è—Ç—å –ª—É—á—à–∏–π —Å—á–µ—Ç –∏–≥—Ä–æ–∫–∞ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç, —Ç–æ–≥–¥–∞ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è 0
    let gameOver = false; // —Ñ–ª–∞–≥ –≥–µ–π–º –æ–≤–µ—Ä–∞
    let isBWTheme = localStorage.getItem('isBWTheme') === 'true'; // –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–º—ã –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏—â–∞

    // –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã DOM
    const gridContainer = document.querySelector('.grid'); // –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–µ—Ç–∫–∏
    const tileContainer = document.querySelector('.tile-container'); // –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–ª–∏—Ç–æ–∫
    const scoreDisplay = document.getElementById('score'); // –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—á–µ—Ç–∞
    const bestScoreDisplay = document.getElementById('best-score'); // –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª—É—á—à–µ–≥–æ —Å—á–µ—Ç–∞
    const gameMessage = document.querySelector('.game-message'); // —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≥–µ–π–º –æ–≤–µ—Ä–µ
    const restartButton = document.getElementById('restart-btn'); // –∫–Ω–æ–ø–∫–∞ —Ä–µ—Å—Ç–∞—Ä—Ç–∞
    const themeButton = document.getElementById('theme-btn'); // –∫–Ω–æ–ø–∫–∞ —Å–º–µ–Ω—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
    const upButton = document.querySelector('.up-btn'); // –∫–Ω–æ–ø–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è –≤–≤–µ—Ä—Ö
    const leftButton = document.querySelector('.left-btn'); // –¥–æ–∫—É–º–µ–Ω—Ç –¥–≤–∏–∂–µ–Ω–∏—è –≤–ª–µ–≤–æ
    const rightButton = document.querySelector('.right-btn'); // –∫–Ω–æ–ø–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è –≤–ø—Ä–∞–≤–æ
    const downButton = document.querySelector('.down-btn'); // –∫–Ω–æ–ø–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è –≤–Ω–∏–∑

    // –†–ê–ó–ú–ï–†–´ –ò–ì–†–û–í–û–ì–û –ü–û–õ–Ø
    const gridSize = 4;

    // –§–£–ù–ö–¶–ò–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò –ò–ì–†–´
    function init() {
        // –£–°–¢–ê–ù–û–í–ö–ê –¢–ï–ú–´ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
        if (isBWTheme) {
            document.body.classList.add('bw-theme'); // –µ—Å–ª–∏ —á–µ—Ä–Ω–æ–±–µ–ª–∞—è, —Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–ª–∞—Å—Å —á–µ—Ä–Ω–æ –±–µ–ª–æ–π —Ç–µ–º—ã
            themeButton.textContent = '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ç–µ–º–∞'; // –∏ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
        } else { // –µ—Å–ª–∏ —Ç–µ–º–∞ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è
            document.body.classList.remove('bw-theme'); // —Ç–æ –∫–ª–∞—Å—Å —á–µ—Ä–Ω–æ-–±–µ–ª–æ–π —Ç–µ–º—ã —É–¥–∞–ª—è–µ—Ç—Å—è
            themeButton.textContent = '–ß–µ—Ä–Ω–æ-–±–µ–ª–∞—è —Ç–µ–º–∞'; // —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è
        }

        // –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è —Ä–µ–∫–æ—Ä–¥–∞
        bestScoreDisplay.textContent = bestScore;

        // –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ 4—Ö4 (—Å–µ—Ç–∫–∏), –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –Ω—É–ª—è–º–∏
        grid = Array(gridSize).fill().map(() => Array(gridSize).fill(0));

        // —Å–±—Ä–æ—Å —Å—á–µ—Ç–∞ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
        score = 0;
        scoreDisplay.textContent = '0'; // –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–≥–æ —Å—á–µ—Ç–∞
        gameOver = false; // —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ —Ñ–æ–ª—Å–µ —Ñ–ª–∞–≥–∞ –≥–µ–π–º –æ–≤–µ—Ä–∞
        gameMessage.style.display = 'none'; // —É–±–∏—Ä–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≥–µ–π–º –æ–≤–µ—Ä–µ

        // –æ—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –ø–ª–∏—Ç–∫–∞–º–∏
        tileContainer.innerHTML = '';

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–≤—É—Ö –Ω–∞—á–∞–ª—å–Ω—ã—Ö –ø–ª–∏—Ç–æ–∫
        addRandomTile();
        addRandomTile();

        // –û–¢–†–ò–°–û–í–ö–ê –°–ï–¢–ö–ò
        render();
    }

    // –§–£–ù–ö–¶–ò–Ø –î–û–ë–ê–í–õ–ï–ù–ò–Ø –°–õ–£–ß–ê–ô–ù–û–ô –ü–õ–ò–¢–ö–ò
    function addRandomTile() {
        const emptyCells = []; // —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Å—Å–∏–≤–∞, –≤ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥—É—Ç –∑–∞–Ω–æ—Å–∏—Ç—å—Å—è –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏

        // –ø–æ–∏—Å–∫ –≤—Å–µ—Ö –Ω—É–ª–µ–≤—ã—Ö —è—á–µ–µ–∫
        // –ø—Ä–æ—Ö–æ–¥–∏—Ç—Å—è –ø–æ –≤—Å–µ–º—É –º–∞—Å—Å–∏–≤—É –∏ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —è—á–µ–π–∫–∏ i j —Ä–∞–≤–Ω—è–µ—Ç—Å—è –Ω—É–ª—é, —Ç–æ –∑–∞–Ω–æ—Å—è—Ç—Å—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –≤–∏–¥–µ x, y –≤ –º–∞—Å—Å–∏–≤ –¥–ª—è –ø—É—Å—Ç—ã—Ö —è—á–µ–µ–∫
        for (let i = 0; i < gridSize; i++) {
            for (let j = 0; j < gridSize; j++) {
                if (grid[i][j] === 0) {
                    emptyCells.push({x: j, y: i});
                }
            }
        }

        // –ï—Å–ª–∏ –µ—Å—Ç—å –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –ø–ª–∏—Ç–∫—É
        if (emptyCells.length > 0) {
            const randomCell = emptyCells[Math.floor(Math.random() * emptyCells.length)]; // –≤—ã–±–æ—Ä —Å–ª—É—á–∞–π–Ω–æ–π —è—á–µ–π–∫–∏ –∏–∑ –º–∞—Å—Å–∏–≤–∞ —Å–æ —Å–ª—É—á–∞–π–Ω—ã–º–∏ —è—á–µ–π–∫–∞–º–∏
            grid[randomCell.y][randomCell.x] = Math.random() < 0.9 ? 2 : 4; // –æ—Å–Ω–æ–≤–Ω–æ–º—É –º–∞—Å—Å–∏—Å–≤—É –ø–æ–ª—è –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º x –∏ y –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å–ª—É—á–∞–π—Ä–Ω–æ–π —è—á–µ–π–∫–∏ —Ä–∞–Ω–¥–æ–º–Ω–æ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è
            // –ª–∏–±–æ –∑–Ω–∞—á–µ–Ω–∏–µ 2 –ª–∏–±–æ –∑–Ω–∞—á–µ–Ω–∏–µ 4
        }
    }

    // –§–£–ù–ö–¶–ò–Ø –û–¢–†–ò–°–û–í–ö–ò –ò–ì–†–û–í–û–ì–û –ü–û–õ–Ø
    function render() {
        tileContainer.innerHTML = ''; // –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞ —Ö—Ç–º–ª —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        // –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø–µ—Ä–µ–±–æ—Ä –≤—Å–µ—Ö —è—á–µ–µ–∫
        for (let i = 0; i < gridSize; i++) {
            for (let j = 0; j < gridSize; j++) {
                // –µ—Å–ª–∏ —è—á–µ–π–∫–∞ –Ω–µ –Ω—É–ª–µ–≤–∞—è (—Ç–∏–ø–æ –µ—Å—Ç—å –ø–ª–∏—Ç–∫–∞), —Ç–æ
                if (grid[i][j] !== 0) {
                    // —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –¥–æ–º–µ —ç–ª–µ–º–µ–Ω—Ç –ø–ª–∏—Ç–∫–∏
                    const tile = document.createElement('div')
                    tile.classList.add('tile', `tile-${grid[i][j]}`); // –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ –¥–ª—è –ø–ª–∏—Ç–∫–∏ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
                    tile.textContent = grid[i][j]; // —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ç–µ–∫—Å—Ç, —Ç–æ –µ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∏—Ç–∫–∏

                    // –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é CSS grid
                    tile.style.gridRow = i + 1; // –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—è —Å 1
                    tile.style.gridColumn = j + 1; // –Ω–æ–º–µ—Ä –∫–æ–ª–æ–Ω–∫–∏, –Ω–∞—á–∏–Ω–∞—è —Å 1

                    tileContainer.appendChild(tile); // –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–π –ø–ª–∏—Ç–∫–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                }
            }
        }
    }

    // –î–≤–∏–∂–µ–Ω–∏–µ –ø–ª–∏—Ç–æ–∫
    function move(direction) {
        if (gameOver) return false; // –µ—Å–ª–∏ –∏–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞, —Ç–æ –¥–≤–∏–∂–µ–Ω–∏—è –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
        // –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–ª–∞–≥–∞, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–µ–≥–æ —Ç–æ, –±—ã–ª–æ –ª–∏ —Å–æ–≤–µ—Ä—à–µ–Ω–æ –¥–≤–∏–∂–µ–Ω–∏–µ
        let moved = false;
        // –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–æ–ø–∏—è —Å–µ—Ç–∫–∏, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –¥–æ —Ç–æ–≥–æ,–∫–∞–∫ –±—ã–ª–æ —Å–æ–≤–µ—Ä—à–µ–Ω–æ –¥–≤–∏–∂–µ–Ω–∏–µ
        let oldGrid = JSON.parse(JSON.stringify(grid));

        // –ü–æ–≤–æ—Ä–æ—Ç —Å–µ—Ç–∫–∏
        // –µ—Å–ª–∏ –¥–≤–∏–∂–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–≤–µ—Ä—Ö, –∏–ª–∏ –≤–Ω–∏–∑, —Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç—Ä–∞–Ω—Å–ø–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–∫–∏
        if (direction === 'up' || direction === 'down') {
            grid = transpose(grid);
        }
        // –¥–ª—è –¥–≤–∏–∂–µ–Ω–∏—è –≤–ø—Ä–∞–≤–æ –∏–ª–∏ –≤–Ω–∏–∑ –Ω—É–∂–Ω–æ –æ—Ç–∑–µ—Ä–∫–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫–∏
        if (direction === 'right' || direction === 'down') {
            grid = grid.map(row => row.reverse());
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è –∏ —Å–ª–∏—è–Ω–∏—è
        // –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ü–∏–∫–ª –ø–æ —Ä–∞–∑–º–µ—Ä—É —Å–µ—Ç–∫–∏
        for (let i = 0; i < gridSize; i++) {
            // –∏–∑ —Å—Ç—Ä–æ–∫–∏ —É–±–∏—Ä–∞—é—Ç—Å—è –Ω—É–ª–∏
            let row = grid[i].filter(val => val !== 0);
            // –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–≥–Ω–æ—Å—Ç—å —Ç–æ–≥–æ, –º–æ–∂–Ω–æ –ª–∏ —Å–ª–∏—Ç—å —Å–æ—Å–µ–¥–Ω–∏–µ –ø–ª–∏—Ç–∫–∏
            for (let j = 0; j < row.length - 1; j++) { // –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ü–∏–∫–ª –ø–æ —è—á–µ–π–∫–∞–º –≤ —Å—Ç—Ä–æ–∫–µ, –¥–æ –º–∞–∫—Å –∑–Ω–∞—á–µ–Ω–∏–µ-1 (—Ç–∞–∫ –∫–∞–∫ –µ—Å–ª–∏ –Ω–∞–¥–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–µ–¥–ø–æ—Å–ª–µ–¥–Ω—é—é –∏ –ø–æ—Å–ª–µ–¥–Ω—é—é –∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è)
                if (row[j] === row[j + 1]) { // –µ—Å–ª–∏ –∏—Å—Å–ª–µ–¥—É–µ–º–∞—è –∏ —Å–ª–µ–¥—É—é—â–∞—è –ø–æ—Å–ª–µ –∏—Å—Å–ª–µ–¥—É–µ–º–æ–π —è—á–µ–π–∫–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ
                    row[j] *= 2; // —Ç–æ –∏—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–º–Ω–æ–∂–∞–µ—Ç—Å—è
                    row[j + 1] = 0; // –≤—Ç–æ—Ä–∞—è –ø–ª–∏—Ç–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—É—Å—Ç–æ–π
                    score += row[j]; // –∫ –∑–Ω–∞—á–µ–Ω–∏—é —Å—á–µ—Ç–∞ –∏–≥—Ä–æ–∫–∞ –ø—Ä–∏–±–∞–≤–ª—è–µ—Ç—Å—è —É–º–Ω–æ–∂–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–∫–Ω–∏–µ –ø–ª–∏—Ç–∫–∏
                    moved = true; // —Ñ–ª–∞–≥—É —Ç–æ–≥–æ, –±—ã–ª–æ –ª–∏ –¥–≤–∏–∂–µ–Ω–∏–µ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ true
                }
            }
            // —Å–Ω–æ–≤–∞ —É–±–∏—Ä–∞–µ–º –≤—Å–µ –Ω—É–ª–∏ –∏–∑ —Å—Ç—Ä–æ–∫–∏, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –ª–∏—à–Ω–∏—Ö –Ω—É–ª–µ–π —Ç–∞–º –≥–¥–µ –∏—Ö –±—ã—Ç—å –Ω–µ –¥–æ–ª–∂–Ω–æ
            row = row.filter(val => val !== 0);
            // –¥–æ–±–∞–≤–ª—è–µ–º –Ω—É–ª–∏, –ø–æ–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —è—á–µ–µ–∫ –≤ —Å—Ç—Ä–æ–∫–µ (–≤ —Ç–æ–º —á–∏—Å–ª–µ –Ω—É–ª–µ–≤—ã—Ö) –Ω–µ —Å—Ç–∞–Ω–µ—Ç —Ä–∞–≤–Ω—è—Ç—å—Å—è –Ω—É–∂–Ω–æ–π –¥–ª–∏–Ω–µ —Å—Ç—Ä–æ–∫–∏
            while (row.length < gridSize) {
                row.push(0);
            }

            grid[i] = row; // –æ–±–Ω–æ–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—è —Å—Ç—Ä–æ–∫—É, –∫–æ—Ç–æ—Ä–∞—è –∏–∑–º–µ–Ω–∏–ª–∞—Å—å
        }

        // –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–∞–∫–æ–µ –±—ã–ª–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è, –µ—Å–ª–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—ã–ª–æ –≤ –ø—Ä–∞–≤–æ, –∏–ª–∏ –≤–Ω–∏–∑
        // —Ç–æ –µ—Å—Ç—å, –µ—Å–ª–∏ –º–∞—Å—Å–∏–≤ —Å —Å–µ—Ç–∫–æ–π –æ—Ç—Ä–∞–∂–∞–ª—Å—è, —Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–±—Ä–∞—Ç–Ω–æ–µ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ
        if (direction === 'right' || direction === 'down') {
            grid = grid.map(row => row.reverse());
        }
        // –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–∞–∫–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è –±—ã–ª–æ, –µ—Å–ª–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—ã–ª–æ –≤–≤–µ—Ä—Ö –∏–ª–∏ –≤–Ω–∏–∑,—Ç–æ –µ—Å—Ç—å
        // –º–∞—Å—Å–∏–≤ —Å —Å–µ—Ç–∫–æ–π —Ç—Ä–∞–Ω—Å–ø–æ–Ω–∏—Ä–æ–≤–∞–ª—Å—è, —Ç–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ–µ —Ç—Ä–∞–Ω—Å–ø–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
        if (direction === 'up' || direction === 'down') {
            grid = transpose(grid);
        }

        // –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ, —Å–ª—É—á–∏–ª–æ—Å—å –ª–∏ –≤—Å–µ-—Ç–∞–∫–∏ –¥–≤–∏–∂–µ–Ω–∏–µ, –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å–æ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–µ–π –º–∞—Å—Å–∏–≤–∞ —Å–µ—Ç–∫–∏
        if (!arraysEqual(oldGrid, grid)) {
            moved = true;
        }

        // –ï—Å–ª–∏ –¥–≤–∏–∂–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –ø–ª–∏—Ç–∫—É
        if (moved) {
            addRandomTile(); // –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–µ–π –ø–ª–∏—Ç–∫–∏
            scoreDisplay.textContent = score; // –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—é —Å—á–µ—Ç–∞ –∏–≥—Ä–æ–∫–∞ –Ω–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–∞
            if (score > bestScore) { // –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–≥–æ, –±–æ–ª—å—à–µ –ª–∏ –Ω–æ–≤—ã–π —Å—á–µ—Ç, —á–µ–º —Å—Ç–∞—Ä—ã–π
                bestScore = score; // —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—é —Ä–µ–∫–æ—Ä–¥–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å—á–µ—Ç–∞
                bestScoreDisplay.textContent = bestScore; // –∏–∑–º–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —É —ç–ª–µ–º–µ–Ω—Ç–∞, –æ—Ç–≤–µ—á–∞—é—â–µ–≥–æ –∑–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–∞
                localStorage.setItem('bestScore', bestScore); // —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø–æ–∫–∞–∑—Ç–µ–ª—è –ª—É—á—à–µ–≥–æ —Å—á–µ—Ç–∞
            }

            render(); // –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç—Å—è —Å–µ—Ç–∫–∞

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
            if (isGameOver()) {
                gameOver = true; // —É—Å—Ç–∞–Ω–∞–≤–∏–ª–≤–∞–µ—Ç—Å—è —Ñ–ª–∞–≥ –≥–µ–π–º –æ–≤–µ—Ä–∞
                gameMessage.querySelector('p').textContent = 'üíÄüíÄüíÄ–°–ª–∏—ÇüíÄüíÄüíÄ'; // —ç–ª–µ–º–µ–Ω—Ç—É —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è —Ç–µ–∫—Å—Ç –æ —Ç–æ–º, —á—Ç–æ
                // –∏–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞
                gameMessage.style.display = 'flex'; // –≤—ã–≤–æ–¥–∏—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ
            }
        }

        return moved; // –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–ª–∞–≥ –¥–≤–∏–∂–µ–Ω–∏—è
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
    function isGameOver() {
        // –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø—É—Å—Ç—ã—Ö —è—á–µ–µ–∫
        // –ø—Ä–æ—Ö–æ–¥–∏—Ç—Å—è –ø–æ –∫–∞–∂–¥–æ–π —è—á–µ–π–∫–µ –º–∞—Å—Å–∏–≤–∞ –∏–≥—Ä–≤–æ–≥–æ –ø–æ–ª—è
        for (let i = 0; i < gridSize; i++) {
            for (let j = 0; j < gridSize; j++) {
                if (grid[i][j] === 0) { // –∏ –µ—Å–ª–∏ –Ω–∞—Ö–æ–¥–∏—Ç —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Å–≤–æ–±–æ–¥–Ω—É—é, —Ç–æ —Ç–æ–≥–¥–∞
                    // –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–æ–ª—Å –Ω–∞—Å—á–µ—Ç —Ç–æ–≥–æ, –æ–∫–æ–Ω—á–µ–Ω–∞ –ª–∏ –∏–≥—Ä–∞
                    return false;
                }
            }
        }

        // –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ, –º–æ–∂–Ω–æ –ª–∏ —Å–¥–µ–ª–∞—Ç—å —Ö–æ—Ç—å –∫–∞–∫–æ–π-–Ω–∏–±—É–¥—å —Ö–æ–¥
        // —Ü–∏–∫–ª –ø–æ –∫–∞–∂–¥–æ–π —è—á–µ–π–∫–µ –º–∞—Å—Å–∏–≤–∞
        for (let i = 0; i < gridSize; i++) {
            for (let j = 0; j < gridSize; j++) {
                const value = grid[i][j]; // –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
                if (j < gridSize - 1 && grid[i][j + 1] === value) {
                    return false; // –µ—Å–ª–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ö–æ–¥, —Ç–æ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Ñ–æ–ª—Å–µ
                }

                if (i < gridSize - 1 && grid[i + 1][j] === value) {
                    return false; // –µ—Å–ª–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ö–æ–¥, —Ç–æ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Ñ–æ–ª—Å–µ
                }
            }
        }
        // –µ—Å–ª–∏ —Ü–∏–∫–ª –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –∏ –Ω–µ—Ç—É –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–¥–µ–ª–∞—Ç—å —Ö–æ–¥, —Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ —Ç—Ä—É (–∏–≥—Ä–∞ –ø—Ä–æ–∏–≥—Ä–∞–Ω–∞)
        return true;
    }

    // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò

    // –§–£–ù–ö–¶–ò–Ø –¢–†–ê–ù–°–ü–û–ù–ò–†–û–í–ê–ù–ò–Ø –ú–ê–¢–†–ò–¶–´
    function transpose(matrix) {
        return matrix[0].map((_, colIndex) => matrix.map(row => row[colIndex]));
    }
    // –§–£–ù–ö–¶–ò–Ø –°–†–ê–í–ù–ï–ù–ò–Ø –î–í–£–• –ú–ê–°–°–ò–í–û–í
    function arraysEqual(a, b) {
        // –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –≤—Å–µ–º —è—á–µ–π–∫–∞–º
        // –±–µ—Ä–µ—Ç i –∏ j
        // –∏ –µ—Å–ª–∏ —Ö–æ—Ç—è –±—ã —É –æ–¥–Ω–æ–π —è—á–µ–π–∫–∏ i –∏ j –Ω–µ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –º–∞—Å—Å–∏–≤–∞—Ö
        // a –∏ b, —Ç–æ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–æ–ª—Å–µ
        for (let i = 0; i < gridSize; i++) {
            for (let j = 0; j < gridSize; j++) {
                if (a[i][j] !== b[i][j]) {
                    return false; // –º–∞—Å—Å–∏–≤—ã –Ω–µ —Ä–∞–≤–Ω—ã
                }
            }
        }
        return true; // –º–∞—Å—Å–∏–≤—ã —Ä–∞–≤–Ω—ã
    }

    // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô

    // –û–ë–†–ê–ë–û–¢–ö–ê –ù–ê–ñ–ê–¢–ò–ô –°–¢–†–ï–õ–û–ö –ù–ê –ö–õ–ê–í–ò–ê–ò–¢–£–†–ï –ö–û–ú–ü–¨–Æ–¢–ï–†–ê
    // —Å–ª—É—à–∞—Ç–µ–ª—å –Ω–∞–∞–∂–∞—Ç–∏—è
    document.addEventListener('keydown', event => {
        // –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ, –∫–∞–∫–∞—è –∫–Ω–æ–ª–ø–∫–∞ –Ω–∞–∂–∞—Ç–∞
        switch(event.key) {
            // –µ—Å–ª–∏ –Ω–∞–∂–∞—Ç–∞ —Å—Ç—Ä–µ–ª–∫–∞ –≤–≤–µ—Ä—Ö
            case 'ArrowUp':
                // –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                event.preventDefault();
                move('up'); // –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–≤–µ—Ä—Ö
                break; // –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
            case 'ArrowDown': // –µ—Å–ª–∏ –Ω–∞–∂–∞—Ç–∞ —Å—Ç—Ä–µ–ª–∫–∞ –≤–Ω–∏–∑
                event.preventDefault(); // –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                move('down'); // –¥–≤–∏–∂–µ–Ω–∏–µ –≤–Ω–∏—Ö
                break;
            case 'ArrowLeft': // –µ—Å–¥–∏ –Ω–∞–∂–∞—Ç–∞ —Å—Ç—Ä–µ–ª–∫–∞ –≤–ª–µ–≤–æ
                event.preventDefault(); // –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–µ–Ω–∏–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                move('left'); // –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ª–µ–≤–æ
                break; // –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
            case 'ArrowRight': // –µ—Å–ª–∏ –Ω–∞–∂–∞—Ç–∞ —Å—Ç—Ä–µ–ª–∫–∞ –≤–ø—Ä–∞–≤–æ
                event.preventDefault(); // –ø—Ä–æ–∏—Å—Ö–æ–∏–¥—Ç –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                move('right'); // –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ø—Ä–∞–≤–æ
                break; // –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
        }
    });

    // –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    // –µ—Å–ª–∏ –Ω–∞–∂–∏–º–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ –≤–≤–µ—Ä—Ö, —Ç–æ –¥–≤–∏–∂–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö
    upButton.addEventListener('click', () => move('up'));
    downButton.addEventListener('click', () => move('down')); // –µ—Å–ª–∏ –Ω–∞–∂–∏–º–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ –≤–Ω–∏–∑, —Ç–æ –¥–≤–∏–∂–µ–Ω–∏–µ –≤–Ω–∏–∑
    leftButton.addEventListener('click', () => move('left')); // –µ—Å–ª–∏ –Ω–∞–∂–∏–º–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ –≤–ª–µ–≤–æ, —Ç–æ –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ª–µ–≤–æ
    rightButton.addEventListener('click', () => move('right')); // –µ—Å–ª–∏ –Ω–∞–∂–∏–º–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ –≤–ø—Ä–∞–≤–æ, —Ç–æ –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ø—Ä–∞–≤–æ

    // –∫–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏–≥—Ä—ã
    restartButton.addEventListener('click', init); // –µ—Å–ª–∏ –Ω–∞–∂–∞—Ç–∞, —Ç–æ –∑–∞–Ω–æ–≤–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∏–≥—Ä–∞

    // –∫–Ω–æ–ø–∫–∞ —Å–º–µ–Ω—ã —Ç–µ–º—ã
    themeButton.addEventListener('click', () => {
        isBWTheme = !isBWTheme; // —Ç–µ–º–∞ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—É—é
        localStorage.setItem('isBWTheme', isBWTheme); //—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

        if (isBWTheme) {
            document.body.classList.add('bw-theme'); // –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ —á–µ—Ä–Ω–æ-–±–µ–ª–∞—è —Ç–µ–º–∞, —Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç
            themeButton.textContent = '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ç–µ–º–∞'; // –º–µ–Ω—è–µ—Ç—Å—è —Ç–µ–∫—Å—Ç —É –∫–Ω–æ–ø–∫–∏
        } else {
            document.body.classList.remove('bw-theme'); // –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ç–µ–º–∞, –¥–æ —á–µ—Ä–Ω–æ –±–µ–ª–∞—è —É–¥–∞–ª—è–µ—Ç—Å—è
            themeButton.textContent = '–ß–µ—Ä–Ω–æ-–±–µ–ª–∞—è —Ç–µ–º–∞'; // –º–µ–Ω—è–µ—Ç—Å—è —Ç–µ–∫—Å—Ç —É –∫–Ω–æ–ø–∫–∏
        }
    });

    // –∫–Ω–æ–ø–∫–∞ "–°—ã–≥—Ä–∞—Ç—å –µ—â–µ" –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∏–≥—Ä—ã
    gameMessage.querySelector('button').addEventListener('click', init);

    // –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤–∞–π–ø–æ–≤ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
    let touchStartX, touchStartY, touchEndX, touchEndY;

    // —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∫–∞—Å–∞–Ω–∏—è –Ω–∞—á–∞–ª—å–Ω—ã—Ö
    document.addEventListener('touchstart', event => {
        touchStartX = event.touches[0].clientX;
        touchStartY = event.touches[0].clientY;
    }, { passive: true });
    // —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∫–∞—Å–∞–Ω–∏—è –∫–æ–Ω–µ—á–Ω—ã—Ö
    document.addEventListener('touchend', event => {
        touchEndX = event.changedTouches[0].clientX;
        touchEndY = event.changedTouches[0].clientY;
    // –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤–∞–π–ø–∞
        handleSwipe();
    }, { passive: true });

    // –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Å–∫—Ä–æ–ª–ª–∞ –ø—Ä–∏ —Å–≤–∞–π–ø–∞—Ö
    document.addEventListener('touchmove', function(event) {
        // –ø—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ª–∏ –∫–∞—Å–∞–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ –∏–≥—Ä–æ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏
        if (event.target.closest('.game-container')) {
            event.preventDefault();
        }
    }, { passive: false });
    // —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–≤–∞–π–ø–æ–≤
    function handleSwipe() {
        const dx = touchEndX - touchStartX; // –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞–∑–Ω–∏—Ü—ã –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏
        const dy = touchEndY - touchStartY; // –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞–∑–Ω–∏—Ü—ã –ø–æ –≤–µ—Ç—Ä–∏–∫–∞–ª–∏

        // –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–≤–∞–π–ø–∞
        const minSwipeDistance = 30;
        // –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–≤–∞–π–ø–∞
        if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > minSwipeDistance) { // —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–æ–≥–æ, –∫–∞–∫–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ (–º–æ–¥—É–ª—å) –±–æ–ª—å—à–µ
        // –µ—Å–ª–∏ —Ä–∞–∑–Ω–∏—Ü–∞ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ –±–æ–ª—å—à–µ —Ä–∞–∑–Ω–∏—Ü—ã –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ –∏ –±–æ–ª—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ –¥–ª—è –∑–∞—Å—á–∏—Ç—ã–≤–∞–Ω–∏—è —Å–≤–∞–π–ø–∞, —Ç–æ
        // –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
            // –µ—Å–ª–∏ —Ä–∞–∑–Ω–∏—Ü–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞ (–¥–≤–∏–∂–µ–Ω–∏–µ –±—ã–ª–æ —Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ), —Ç–æ –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ø—Ä–∞–≤–æ
            if (dx > 0) {
                move('right');
            // –µ—Å–ª–∏ —Ä–∞–∑–Ω–∏—Ü–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞ (–¥–≤–∏–∂–µ–Ω–∏–µ –±—ã–ª–æ —Å–ø—Ä–∞–≤–∞ –Ω–∞ –ª–µ–≤–æ), —Ç–æ –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ª–µ–≤–æ
            } else {
                move('left');
            }
        // –µ—Å–ª–∏ —Ä–∞–∑–Ω–∏—Ü–∞ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ –±–æ–ª—å—à–µ —Ä–∞–∑–Ω–∏—Ü—ã –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ (–º–æ–¥—É–ª–∏) –∏ —Ä–∞–∑–Ω–∏—Ü–∞ (–º–æ–¥—É–ª—å) –±–æ–ª—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π
        // –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ –¥–ª—è —Å–≤–∞–π–ø–∞, —Ç–æ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
        } else if (Math.abs(dy) > Math.abs(dx) && Math.abs(dy) > minSwipeDistance) {
            // –µ—Å–ª–∏ —Ä–∞–∑–Ω–∏—Ü–∞ –±–æ–ª—å—à–µ –Ω—É–ª—è (–¥–≤–∏–∂–µ–Ω–∏–µ –±—ã–ª–æ –≤–Ω–∏–∑), —Ç–æ –¥–≤–∏–∂–µ–Ω–∏–µ –≤–Ω–∏–∑
            if (dy > 0) {
                move('down');
            // –µ—Å–ª–∏ —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–Ω—å—à–µ –Ω—É–ª—è (–¥–≤–∏–∂–µ–Ω–∏–µ –±—ã–ª–æ –≤–≤–µ—Ä—Ö), —Ç–æ –¥–≤–∏–∂–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö
            } else {
                move('up');
            }
        }
    }

    // –∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã
    init();
});